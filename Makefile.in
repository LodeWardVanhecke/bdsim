name=bdsim
G4TARGET=$(name)
G4EXLIB=true

G4BINDIR=@BINDIR
G4INSTALL=@G4INSTALL
ROOTSYS=@ROOTSYS

.PHONY: all
all: lib bin parser

ROOTLIBS=`$(ROOTSYS)/bin/root-config --libs`
ROOTCFLAGS=`$(ROOTSYS)/bin/root-config --cflags`

XMLCFLAGS=`xml2-config --cflags`
XMLLIBS=`xml2-config --libs`

LDLIBS3 += $(ROOTLIBS) GDML_LIBFLAG

# standard Geant4 make procedure
include $(G4INSTALL)/config/binmake.gmk


CPPFLAGS += -DG4VERSION=@G4VERSION -D@USE_ROOT -D@USE_XML -DCLHEP_VERSION=@CLHEP_VERSION
CPPFLAGS += -Df2cFortran
CPPFLAGS += $(ROOTCFLAGS) GDML_CPPFLAG
CPPFLAGS += -g -Wall $(ROOTINCS) -I.

LDFLAGS += -L$(G4LIBDIR) -L./parser -lgmad

install:

distrib:
	tar --ignore-failed-read -C .. -czvf BDSIM.tar.gz BDSIM/src BDSIM/include \
	BDSIM/bdsim.cc BDSIM/bdsimrun BDSIM/Makefile.in \
	BDSIM/configure BDSIM/README \
	BDSIM/parser/*.h BDSIM/examples \
	BDSIM/BDS_vis.mac BDSIM/gui.mac\
        BDSIM/docs BDSIM/parser \
	BDSIM/examples BDSIM/utils

docs:
	$(MAKE) -C docs

parser: parser/parser.h parser/parser.y parser/parser.l parser/gmad.h \
        parser/gmad.cc parser/sym_table.h
	$(MAKE) -C parser
