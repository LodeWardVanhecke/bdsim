!include optics.gmad;

! some beamline parameters
                                                                                                               
option, beampipeRadius = 2 * cm,
        boxSize = 2.3 * m,
        tunnelRadius= 3.0 * m,
        beampipeThickness = 0.1 * cm,
        chordStepMinimum = 0.0000000001 * m,
        deltaIntersection = 0.00000001 * m,
	deltaChord = 0.001 * m,
        lengthSafety = 0.00001 * m,
        thresholdCutCharged = 1 * KeV,
        thresholdCutPhotons = 1 * KeV;
                                                                                                               
                                                                                                               
! beamline definiton
             
dl = 1 * m;                                                                                                  
                                   
qdk1 = -0.1;
qfk1 = 0.1;
                                                                            
qd: quadrupole,l=0.5 * m, k1 = qdk1;
qf: quadrupole,l=0.5 *m, k1 = qfk1;
d: drift,l=dl;
d2 : drift, l = 10 * m;
sex: sextupole, l=1 * m, k2 = 10;

e:element,l=1*m,geometry="mokka:stahl.sql", bmap="mokka:stahl.sql";

msk:element,l=1*m,geometry="gmad:mk.geo",bmap="gmad:mk.bmap";


sb1l = 20 * m;
sbl = 1 *m;


sb:sbend,l=sbl,angle=pi/16;
sb1:sbend,l=sbl,angle=pi/32;
startl:marker;
endl:marker;
 
cell : line = (d,qf,d);
arc : line = (cell,cell,sb,sb);
arc2 : line = (arc,arc,arc,arc,arc,arc,arc);
                   
arc_pi4 : line = (sb1,sb1,sb1,sb1,sb1,sb1,sb1,sb1);

test_line : line = (startl,arc_pi4,arc_pi4,arc_pi4,arc_pi4,
                    endl);

c1:rcol,l=0.5*m,xsize=2*mm,  material="Al";

sp1:ecol,l=4*m,xsize=50*mm, ysize=50*mm, 
material="Graphite";

!test_e : line = (startl,c1,d,sb,d,sp1,d,sb,d,endl);

dskew:drift,l=1*m, tilt=pi/4;

tt : transform3d,x=0,y=0,z=0,phi=0,theta=0,psi=pi/2;
tti : transform3d,x=0,y=0,z=0,phi=pi/4,theta=0,psi=0;

d2:drift,l=1*m,aper=50*cm;
d3:drift,l=1*m,aper=1*cm;

test1:line=(d,d,d,d,qd,qd,qf,d,d,d);

!use, period=test_e;
use,period=test1;
                                                                                           
!sample, range=sb[1];
!csample, range=d[1],l=1.1*m, r=2*m;
!sample, range=startl;
!sample,range=endl;

beam,  particle="e-",
       energy=100.0 * GeV,
       nparticles=1e+3,
       distrType="gauss",
       energySpread=0,
       Rmin=1.99*mm,
       Rmax=2*mm,
       sigmaX=0.0*cm,
       sigmaY=0.0*cm,
       sigmaXp=0.01 ,
       sigmaYp=0.02 ;

option, ngenerate=100, turnInteractions=1, stopTracks=1,
useEMHadronic=0;
